!function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=2)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.TOP=0]="TOP",t[t.TOP_RIGHT=1]="TOP_RIGHT",t[t.RIGHT=2]="RIGHT",t[t.BOTTOM_RIGHT=3]="BOTTOM_RIGHT",t[t.BOTTOM=4]="BOTTOM",t[t.BOTTOM_LEFT=5]="BOTTOM_LEFT",t[t.LEFT=6]="LEFT",t[t.TOP_LEFT=7]="TOP_LEFT",t[t.ILLEGAL=8]="ILLEGAL"}(e.RelativePosition||(e.RelativePosition={}))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0);e.Position=class{constructor(t,e){this.i=t,this.j=e}isNear(t){return!(Math.abs(t.i-this.i)>1||Math.abs(t.j-this.j)>1)&&(t.i!=this.i||t.j!=this.j)}isAdjacent(t){return Math.abs(t.i-this.i)+Math.abs(t.j-this.j)==1}getPositionRelativeToMe(t){if(!t.isNear(this))return s.RelativePosition.ILLEGAL;let e=t.i-this.i,i=t.j-this.j;return Math.abs(e)>1||Math.abs(i)>1?s.RelativePosition.ILLEGAL:e<0&&i<0?s.RelativePosition.TOP_LEFT:e<0&&0==i?s.RelativePosition.TOP:e<0&&i>0?s.RelativePosition.TOP_RIGHT:0==e&&i<0?s.RelativePosition.LEFT:0==e&&i>0?s.RelativePosition.RIGHT:e>0&&i<0?s.RelativePosition.BOTTOM_LEFT:e>0&&0==i?s.RelativePosition.BOTTOM:e>0&&i>0?s.RelativePosition.BOTTOM_RIGHT:s.RelativePosition.ILLEGAL}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(3),n=i(4),o=i(5),l=i(12),r=i(13);window.onload=function(){let t=document.getElementById("text-penta"),e=document.getElementById("btn-visualise"),i=document.getElementById("btn-convert"),a=document.getElementById("difficulty-input"),c=document.getElementById("title-input"),h=document.getElementById("errors"),f=document.getElementById("warnings"),u=document.getElementById("success"),d=document.getElementById("penta-representation"),p=d.getContext("2d");function g(){let e=o.Serializer.serialize(t.value);return e.penta.difficulty=+a.value,e.penta.filename=c.value,l.PentaChecker.check(e),y.drawPentatonic(e,h,f,u),e}let y=new s.Playground(d,p,new n.Styles(20,20));e.onclick=g,i.onclick=()=>{let t=g();if(t.hasWarningsOrErrors())return void alert("Please fix any errors and warnings before converting to JSON");let e=r.PentaJson.fromPentatonic(t.penta),i=JSON.stringify(e);!function(t,e){let i=document.createElement("a");i.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),i.setAttribute("download",t),i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i)}(e.name+".json",i)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0);e.Playground=class{constructor(t,e,i){this.offsetX=30,this.offsetY=30,this.canvasElement=t,this.totalWidth=this.canvasElement.parentElement.getBoundingClientRect().width,this.canvasElement.setAttribute("width",this.totalWidth.toString()),this.context=e,this.styles=i,this.canvasElement.style.border=this.styles.canvasBorderWidth+"px solid "+this.styles.canvasBorderColor,this.canvasElement.style.margin="auto 20px",this.canvasElement.style.background=this.styles.background}drawCenterSpot(t,e,i){this.context.beginPath(),this.context.arc(t,e,i,0,2*Math.PI),this.context.fillStyle=this.styles.fillColor,this.context.fill(),this.context.lineWidth=this.styles.lineWidth,this.context.strokeStyle=this.styles.borderColor,this.context.stroke()}drawCorner(t,e){this.context.beginPath(),this.context.arc(t,e,10,0,2*Math.PI),this.context.fillStyle=this.styles.fillColor,this.context.fill(),this.context.lineWidth=this.styles.lineWidth,this.context.strokeStyle=this.styles.borderColor,this.context.stroke()}writeText(t,e,i,s=this.styles.font.Heading,n=this.styles.textColor){this.context.font=s,this.context.fillStyle=n,this.context.fillText(t,e,i)}drawLine(t,e,i,s){this.context.beginPath(),this.context.lineWidth=this.styles.borderWidth,this.context.fillStyle=this.styles.borderColor,this.context.strokeStyle=this.styles.borderColor,this.context.moveTo(t,e),this.context.lineTo(i,s),this.context.stroke(),this.context.fill()}drawDiffLine(t,e,i,s){this.context.beginPath(),this.context.lineWidth=this.styles.diffWidth,this.context.fillStyle=this.styles.diffColor,this.context.strokeStyle=this.styles.diffColor,this.context.moveTo(t,e),this.context.lineTo(i,s),this.context.stroke(),this.context.fill()}drawArrowLine(t,e,i,s,n=!1){let o;this.context.beginPath(),this.context.moveTo(t,e),this.context.lineTo(i,s),this.context.strokeStyle=this.styles.fillColor,this.context.lineWidth=this.styles.lineWidth,this.context.stroke();let l=i,r=s;if(n)for(o=0;o<=2;o++)t=l,e=0==o||2==o?r+4:r-4,i=2==o?l:l-4,s=2==o?r-4:r,this.context.beginPath(),this.context.moveTo(t,e),this.context.lineTo(i,s),this.context.lineWidth=2,this.context.strokeStyle=this.styles.fillColor,this.context.stroke();else for(o=0;o<=2;o++)t=l,e=0==o||2==o?r-4:r+4,i=2==o?l:l+4,s=2==o?r+4:r,this.context.beginPath(),this.context.moveTo(t,e),this.context.lineTo(i,s),this.context.lineWidth=this.styles.lineWidth,this.context.strokeStyle=this.styles.fillColor,this.context.stroke()}drawRectangleThinLine(t,e,i,s){this.context.beginPath(),this.context.fillStyle=this.styles.fillColor,this.context.fill(),this.context.fillRect(t,e,i,s),this.context.lineWidth=this.styles.lineWidth,this.context.strokeStyle=this.styles.lineColor,this.context.strokeRect(t,e,i,s)}drawRectangleBorderLine(t,e,i,s){this.context.beginPath(),this.context.lineWidth=this.styles.borderWidth,this.context.strokeStyle=this.styles.borderColor,this.context.strokeRect(t,e,i,s)}drawPentatonic(t,e,i,s){console.log("trying to draw: ",t),console.log("errors: "+t.errors),console.log("Warnings: "+t.warnings);let n=e;t.errors.length>0?n.innerHTML="<ul><li>"+t.errors.join("</li><li>")+"</li></ul>":n.innerText="",t.warnings.length>0?i.innerHTML="<ul><li>"+t.warnings.join("</li><li>")+"</li></ul>":i.textContent="",0==t.errors.length&&0==t.warnings.length?s.textContent="Success!":s.textContent="";let o=t.penta;this.cellSize=(this.totalWidth-2*this.offsetX)/o.columns;let l=this.totalWidth*o.lines/o.columns;this.canvasElement.setAttribute("height",l.toString()),this.drawEachCell(o),t.errors.length>0||(this.drawVerticalSeparations(o),this.drawHorizontalSeparations(o),this.drawAllClues(o))}drawEachCell(t){for(let e=0;e<t.lines;e++)for(let i=0;i<t.columns;i++)this.drawRectangleThinLine(this.offsetX+i*this.cellSize,this.offsetY+e*this.cellSize,this.cellSize,this.cellSize);this.drawRectangleBorderLine(this.offsetX,this.offsetY,t.columns*this.cellSize,t.lines*this.cellSize)}drawVerticalSeparations(t){for(let e=0;e<t.lines;e++)for(let i=1;i<t.columns;i++)t.cells[e][i].area.id!=t.cells[e][i-1].area.id&&this.drawLine(this.offsetX+i*this.cellSize,this.offsetY+e*this.cellSize,this.offsetX+i*this.cellSize,this.offsetY+(e+1)*this.cellSize)}drawHorizontalSeparations(t){for(let e=0;e<t.columns;e++)for(let i=1;i<t.lines;i++)t.cells[i][e].area.id!=t.cells[i-1][e].area.id&&this.drawLine(this.offsetX+e*this.cellSize,this.offsetY+i*this.cellSize,this.offsetX+(e+1)*this.cellSize,this.offsetY+i*this.cellSize)}drawAllClues(t){t.cellArray().filter(e=>1==e.values.length||t.sistersHave(e.position)).forEach(e=>{1==e.values.length&&this.writeText(e.values[0],this.offsetX+e.position.j*this.cellSize+this.cellSize/3,this.offsetY+e.position.i*this.cellSize+3*this.cellSize/5),t.sistersHave(e.position)&&this.writeText(t.getSisterSymbol(e.position),this.offsetX+e.position.j*this.cellSize+.2*this.cellSize,this.offsetY+e.position.i*this.cellSize+.4*this.cellSize,this.styles.font.Default,this.styles.sisterColor)}),this.drawDiffOnes(t)}drawDiffOnes(t){t.diffOnes.forEach(t=>{let e,i,n,o,l=[],r=[];for(let e=0;e<5;e++)l.push(this.offsetX+t.position1.j*this.cellSize+this.cellSize*e/4),r.push(this.offsetY+t.position1.i*this.cellSize+this.cellSize*e/4);switch(t.position1.getPositionRelativeToMe(t.position2)){case s.RelativePosition.TOP:e=l[2],i=l[2],n=2*r[0]-r[1],o=r[1];break;case s.RelativePosition.RIGHT:e=2*l[4]-l[3],i=l[3],n=r[2],o=r[2];break;case s.RelativePosition.BOTTOM:e=l[2],i=l[2],n=2*r[4]-r[3],o=r[3];break;case s.RelativePosition.LEFT:e=2*l[0]-l[1],i=l[1],n=r[2],o=r[2];break;case s.RelativePosition.TOP_RIGHT:e=2*l[4]-l[3],i=l[3],n=2*r[0]-r[1],o=r[1];break;case s.RelativePosition.BOTTOM_RIGHT:e=2*l[4]-l[3],i=l[3],n=2*r[4]-r[3],o=r[3];break;case s.RelativePosition.BOTTOM_LEFT:e=2*l[0]-l[1],i=l[1],n=2*r[4]-r[3],o=r[3];break;case s.RelativePosition.TOP_LEFT:e=2*l[0]-l[1],i=l[1],n=2*r[0]-r[1],o=r[1];break;case s.RelativePosition.ILLEGAL:return void console.log("Illegal position")}this.drawDiffLine(e,n,i,o)})}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.Styles=class{constructor(t,e){this.widthCell=t,this.heightCell=e,this.background="#fff5ea",this.borderColor="#343653",this.canvasBorderColor="#ae0066",this.canvasBorderWidth=1,this.lineWidth=2,this.borderWidth=10,this.diffWidth=5,this.fillColor="#fff0e6",this.textColor="#d62061",this.lineColor="#6dc2ff",this.diffColor="#ff2955",this.sisterColor="#339bcb",this.font={Default:"27px 'Segoe UI',Arial,sans-serif",Heading:"44px 'Segoe UI',Arial,sans-serif"}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(6),n=i(8),o=i(9),l=i(1),r=i(10),a=i(11);class c{static serialize(t){let e=new s.PentaWarningError,i=e.penta;console.log("We want to serialize: "+t);let n=t.split(/[\r\n]+/);if(n.length<this.minLines)return e.addError("Text for penta should contain: \nauthor, nbLine nbCols, penta"),e;i.author=n[0].trim(),console.log("Author is :"+i.author);let o=n[1].trim().split(" ").map(t=>Number(t));return console.log("We have lineCol: "+o),2!=o.length?(e.addError('2nd line should provide nb of lines and columns like this "nbLines nbCols"'),e):(i.lines=o[0],i.columns=o[1],n.length<this.minLines+i.lines?(e.addError("You didn't provide a pentatonic with "+i.lines+" lines"),e):(this.fillAreas(e,n,2),e.errors.length>0?e:(this.fillEnonce(e,n,2+i.lines),e)))}static fillAreas(t,e,i){let s,l={};for(let r=i;r<i+t.penta.lines;r++){let a=r-i;if(s=e[r].trim(),""==s||null==s)continue;let c=[];if(s.length!=t.penta.columns){t.addError("Mismatch between number of columns ("+t.penta.columns+') and the size of the line"'+s+'" (cf. line number '+(r+1)+")");break}for(let e=0;e<t.penta.columns;e++){let t=new o.Cell(a,e),i=l[s[e]];null==i&&(i=new n.Area(s[e]),l[s[e]]=i),t.area=i,c.push(t)}t.penta.cells.push(c)}let r=t.penta.fillAreaSize();t.addWarnings(r)}static fillEnonce(t,e,i){let s,n=e.length,o={};for(let a=i;a<n;a++){if(s=e[a].trim(),""==s)continue;if(s.startsWith("-")){let e=s.substr(1).split(",").map(t=>+t);if(4!=e.length){t.addError('For a diffOne, you should have 4 numbers: "-i1,j1,i2,j2" for example. But you typed "'+s+'"');break}let i=new l.Position(e[0],e[1]),n=new l.Position(e[2],e[3]);if(i==n){t.addError('Difference one should concern 2 different positions. But you typed "'+s+'"');continue}i.isNear(n)||t.addWarning('Difference one should concert 2 near positions. But you typed "'+s+'"'),t.penta.diffOnes.push(new r.Diff(i,n));continue}let i=s.split(",");if(3!=i.length){t.addError("Bad input, should be n,i,j, but was "+s);continue}if(1!=i[0].length){t.addError("Bad input: "+i[0]+" in line "+s);continue}let n=i[0],c=+i[1],h=+i[2];if(c>=t.penta.lines){t.addError("Line i = "+c+' is out of bounds in "'+s+'": number of lines = '+t.penta.lines+" (cf. line "+(a+1)+")");continue}if(h>=t.penta.columns){t.addError("Column j = "+h+' is out of bounds in "'+s+'": number of columns = '+t.penta.columns+" (cf. line "+(a+1)+")");continue}let f=t.penta.cells[c][h],u=+n;if(Number.isNaN(u))null==o[n]?o[n]=[new l.Position(c,h)]:o[n].push(new l.Position(c,h));else{console.log("nb is "+n);let t=+n;console.log("Success converting nb to number: "+t),f.values.push(n)}}for(let e in o)t.penta.sisters.push(new a.Sister(e,e,o[e]))}}c.minLines=2,e.Serializer=c},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(7);e.PentaWarningError=class{constructor(){this.penta=new s.Pentatonic,this.warnings=[],this.errors=[]}addWarning(t){this.warnings.push(t)}addWarnings(t){t.forEach(t=>this.addWarning(t))}addError(t){this.errors.push(t)}hasWarningsOrErrors(){return this.warnings.length>0||this.errors.length>0}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.Pentatonic=class{constructor(t=0,e=0){this.id=0,this.version=0,this.areas="",this.difficulty=0,this.author="",this.filename="",this.MAX_AREA_SIZE=5,this.lines=t,this.columns=e,this.cells=[],this.diffOnes=[],this.sisters=[]}fillAreaSize(){let t=[];return this.getAllAreas().forEach(e=>{let i=this.getAreaCells(e),s=i.size;i.forEach(t=>t.area.size=s),s>this.MAX_AREA_SIZE&&t.push("Area with id "+e.id+" is bigger than the max ("+s+" > "+this.MAX_AREA_SIZE+")")}),t}cellArray(){let t=[];for(let e of this.cells)for(let i of e)t.push(i);return t}getAllAreas(){let t=new Set;return this.cellArray().forEach(e=>{t.add(e.area)}),t}getAreaCells(t){return new Set(this.cellArray().filter(e=>e.area.id==t.id))}getAreaPositions(t){return new Set(this.cellArray().filter(e=>e.area.id==t.id).map(t=>t.position))}diffOnesHave(t){for(let e of this.diffOnes)if(e.position1==t||e.position2==t)return!0;return!1}sistersHave(t){for(let e of this.sisters)if(e.positions.filter(e=>e.i==t.i&&e.j==t.j).length>0)return!0;return!1}getSisterSymbol(t){for(let e of this.sisters)if(e.positions.filter(e=>e.i==t.i&&e.j==t.j).length>0)return e.symbol;return""}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.Area=class{constructor(t="0",e=0){this.id=t,this.size=e}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(1);e.Cell=class{constructor(t,e){this.position=new s.Position(t,e),this.values=[]}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.Diff=class{constructor(t,e){this.position1=t,this.position2=e}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.Sister=class{constructor(t,e,i){this.id=t,this.symbol=e,this.positions=i}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{static check(t){s.checkAreas(t)}static checkAreas(t){let e=t.penta;e.getAllAreas().forEach(i=>{let s=e.getAreaPositions(i),n=[];s.forEach(t=>n.push(t)),this.checkAdjacent(n)||t.addWarning("Probable error with area id "+i.id+": it has disjoint areas!")})}static checkAdjacent(t){if(0==t.length)return!0;let e=[],i=t[0];for(;null!=i;){e.push(i);let s=t.indexOf(i,0);s>-1&&t.splice(s,1),i=this.getFirstAdjacentSets(e,t)}return 0==t.length}static getFirstAdjacent(t,e){for(let i of e)if(t.isAdjacent(i))return i;return null}static getFirstAdjacentSets(t,e){for(let i of t){let t=this.getFirstAdjacent(i,e);if(null!=t)return t}return null}}e.PentaChecker=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(14);class n{constructor(){this.values=[],this.data=[],this.differences=[],this.sisters=[]}static fromPentatonic(t){let e=new n;return e.author=t.author,e.difficulty=t.difficulty,e.name=t.filename,e.width=t.columns,e.height=t.lines,e.differences=t.diffOnes,e.sisters=t.sisters,e.data=t.cells.map(t=>t.map(t=>t.area.id)),e.values=t.cellArray().filter(t=>1==t.values.length).map(t=>new s.Value(+t.values[0],t.position.i,t.position.j)),e}}e.PentaJson=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.Value=class{constructor(t,e,i){this.val=t,this.i=e,this.j=i}}}]);
//# sourceMappingURL=bundle.js.map