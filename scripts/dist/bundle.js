!function(t){var e={};function i(s){if(e[s])return e[s].exports;var o=e[s]={i:s,l:!1,exports:{}};return t[s].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(s,o,function(e){return t[e]}.bind(null,o));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=2)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.TOP=0]="TOP",t[t.TOP_RIGHT=1]="TOP_RIGHT",t[t.RIGHT=2]="RIGHT",t[t.BOTTOM_RIGHT=3]="BOTTOM_RIGHT",t[t.BOTTOM=4]="BOTTOM",t[t.BOTTOM_LEFT=5]="BOTTOM_LEFT",t[t.LEFT=6]="LEFT",t[t.TOP_LEFT=7]="TOP_LEFT",t[t.ILLEGAL=8]="ILLEGAL"}(e.RelativePosition||(e.RelativePosition={}))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0);e.Position=class{constructor(t,e){this.i=t,this.j=e}isNear(t){return!(Math.abs(t.i-this.i)>1||Math.abs(t.j-this.j)>1||t.i==this.i&&t.j==this.j)}getPositionRelativeToMe(t){if(!t.isNear(this))return s.RelativePosition.ILLEGAL;let e=t.i-this.i,i=t.j-this.j;return Math.abs(e)>1||Math.abs(i)>1?s.RelativePosition.ILLEGAL:e<0&&i<0?s.RelativePosition.TOP_LEFT:e<0&&0==i?s.RelativePosition.TOP:e<0&&i>0?s.RelativePosition.TOP_RIGHT:0==e&&i<0?s.RelativePosition.LEFT:0==e&&i>0?s.RelativePosition.RIGHT:e>0&&i<0?s.RelativePosition.BOTTOM_LEFT:e>0&&0==i?s.RelativePosition.BOTTOM:e>0&&i>0?s.RelativePosition.BOTTOM_RIGHT:s.RelativePosition.ILLEGAL}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(3),o=i(4),n=i(5);let l=1e3,r=500,h=Math.ceil(70*r/100),a=Math.ceil(12*l/100);Math.ceil(30*r/100/2),Math.ceil(12*l/100),Math.ceil(60*h/100),Math.ceil(a/2),Math.ceil(l-a/2),Math.ceil(2*r/100);window.onload=function(){let t=document.getElementById("text-penta"),e=document.getElementById("btn-convert"),i=document.getElementById("errors"),l=document.getElementById("warnings"),r=document.getElementById("success"),h=document.getElementById("penta-representation"),a=h.getContext("2d"),c=new s.Playground(h,a,new o.Styles(20,20));e.onclick=(()=>{let e=n.Serializer.serialize(t.value);c.drawPentatonic(e,i,l,r)})}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0);e.Playground=class{constructor(t,e,i){this.offsetX=30,this.offsetY=30,this.canvasElement=t,this.totalWidth=this.canvasElement.parentElement.getBoundingClientRect().width,this.canvasElement.setAttribute("width",this.totalWidth.toString()),this.context=e,this.styles=i,this.canvasElement.style.border=this.styles.canvasBorderWidth+"px solid "+this.styles.canvasBorderColor,this.canvasElement.style.margin="auto 20px",this.canvasElement.style.background=this.styles.background}drawCenterSpot(t,e,i){this.context.beginPath(),this.context.arc(t,e,i,0,2*Math.PI),this.context.fillStyle=this.styles.fillColor,this.context.fill(),this.context.lineWidth=this.styles.lineWidth,this.context.strokeStyle=this.styles.borderColor,this.context.stroke()}drawCorner(t,e){this.context.beginPath(),this.context.arc(t,e,10,0,2*Math.PI),this.context.fillStyle=this.styles.fillColor,this.context.fill(),this.context.lineWidth=this.styles.lineWidth,this.context.strokeStyle=this.styles.borderColor,this.context.stroke()}writeText(t,e,i,s=this.styles.font.Heading,o=this.styles.textColor){this.context.font=s,this.context.fillStyle=o,this.context.fillText(t,e,i)}drawLine(t,e,i,s){this.context.beginPath(),this.context.lineWidth=this.styles.borderWidth,this.context.fillStyle=this.styles.borderColor,this.context.strokeStyle=this.styles.borderColor,this.context.moveTo(t,e),this.context.lineTo(i,s),this.context.stroke(),this.context.fill()}drawDiffLine(t,e,i,s){this.context.beginPath(),this.context.lineWidth=this.styles.diffWidth,this.context.fillStyle=this.styles.diffColor,this.context.strokeStyle=this.styles.diffColor,this.context.moveTo(t,e),this.context.lineTo(i,s),this.context.stroke(),this.context.fill()}drawArrowLine(t,e,i,s,o=!1){let n;this.context.beginPath(),this.context.moveTo(t,e),this.context.lineTo(i,s),this.context.strokeStyle=this.styles.fillColor,this.context.lineWidth=this.styles.lineWidth,this.context.stroke();let l=i,r=s;if(o)for(n=0;n<=2;n++)t=l,e=0==n||2==n?r+4:r-4,i=2==n?l:l-4,s=2==n?r-4:r,this.context.beginPath(),this.context.moveTo(t,e),this.context.lineTo(i,s),this.context.lineWidth=2,this.context.strokeStyle=this.styles.fillColor,this.context.stroke();else for(n=0;n<=2;n++)t=l,e=0==n||2==n?r-4:r+4,i=2==n?l:l+4,s=2==n?r+4:r,this.context.beginPath(),this.context.moveTo(t,e),this.context.lineTo(i,s),this.context.lineWidth=this.styles.lineWidth,this.context.strokeStyle=this.styles.fillColor,this.context.stroke()}drawRectangleThinLine(t,e,i,s){this.context.beginPath(),this.context.fillStyle=this.styles.fillColor,this.context.fill(),this.context.fillRect(t,e,i,s),this.context.lineWidth=this.styles.lineWidth,this.context.strokeStyle=this.styles.lineColor,this.context.strokeRect(t,e,i,s)}drawRectangleBorderLine(t,e,i,s){this.context.beginPath(),this.context.lineWidth=this.styles.borderWidth,this.context.strokeStyle=this.styles.borderColor,this.context.strokeRect(t,e,i,s)}drawPentatonic(t,e,i,s){console.log("trying to draw: ",t),console.log("errors: "+t.errors),console.log("Warnings: "+t.warnings),e.textContent=t.errors.join("<br>"),i.textContent=t.warnings.join("<br>"),0==t.errors.length&&0==t.warnings.length?s.textContent="Success!":s.textContent="";let o=t.penta;this.cellSize=(this.totalWidth-2*this.offsetX)/o.columns;let n=this.totalWidth*o.lines/o.columns;this.canvasElement.setAttribute("height",n.toString()),this.drawEachCell(o),this.drawVerticalSeparations(o),this.drawHorizontalSeparations(o),this.drawAllClues(o)}drawEachCell(t){for(let e=0;e<t.lines;e++)for(let i=0;i<t.columns;i++)this.drawRectangleThinLine(this.offsetX+i*this.cellSize,this.offsetY+e*this.cellSize,this.cellSize,this.cellSize);this.drawRectangleBorderLine(this.offsetX,this.offsetY,t.columns*this.cellSize,t.lines*this.cellSize)}drawVerticalSeparations(t){for(let e=0;e<t.lines;e++)for(let i=1;i<t.columns;i++)t.cells[e][i].area.id!=t.cells[e][i-1].area.id&&this.drawLine(this.offsetX+i*this.cellSize,this.offsetY+e*this.cellSize,this.offsetX+i*this.cellSize,this.offsetY+(e+1)*this.cellSize)}drawHorizontalSeparations(t){for(let e=0;e<t.columns;e++)for(let i=1;i<t.lines;i++)t.cells[i][e].area.id!=t.cells[i-1][e].area.id&&this.drawLine(this.offsetX+e*this.cellSize,this.offsetY+i*this.cellSize,this.offsetX+(e+1)*this.cellSize,this.offsetY+i*this.cellSize)}drawAllClues(t){t.cellArray().filter(e=>1==e.values.length||t.sistersHave(e.position)).forEach(e=>{1==e.values.length&&this.writeText(e.values[0],this.offsetX+e.position.j*this.cellSize+this.cellSize/3,this.offsetY+e.position.i*this.cellSize+3*this.cellSize/5),t.sistersHave(e.position)&&this.writeText(t.getSisterSymbol(e.position),this.offsetX+e.position.j*this.cellSize+.2*this.cellSize,this.offsetY+e.position.i*this.cellSize+.4*this.cellSize,this.styles.font.Default,this.styles.sisterColor)}),this.drawDiffOnes(t)}drawDiffOnes(t){t.diffOnes.forEach(t=>{let e,i,o,n,l=[],r=[];for(let e=0;e<5;e++)l.push(this.offsetX+t.position1.j*this.cellSize+this.cellSize*e/4),r.push(this.offsetY+t.position1.i*this.cellSize+this.cellSize*e/4);switch(t.position1.getPositionRelativeToMe(t.position2)){case s.RelativePosition.TOP:e=l[2],i=l[2],o=2*r[0]-r[1],n=r[1];break;case s.RelativePosition.RIGHT:e=2*l[4]-l[3],i=l[3],o=r[2],n=r[2];break;case s.RelativePosition.BOTTOM:e=l[2],i=l[2],o=2*r[4]-r[3],n=r[3];break;case s.RelativePosition.LEFT:e=2*l[0]-l[1],i=l[1],o=r[2],n=r[2];break;case s.RelativePosition.TOP_RIGHT:e=2*l[4]-l[3],i=l[3],o=2*r[0]-r[1],n=r[1];break;case s.RelativePosition.BOTTOM_RIGHT:e=2*l[4]-l[3],i=l[3],o=2*r[4]-r[3],n=r[3];break;case s.RelativePosition.BOTTOM_LEFT:e=2*l[0]-l[1],i=l[1],o=2*r[4]-r[3],n=r[3];break;case s.RelativePosition.TOP_LEFT:e=2*l[0]-l[1],i=l[1],o=2*r[0]-r[1],n=r[1];break;case s.RelativePosition.ILLEGAL:return void console.log("Illegal position")}this.drawDiffLine(e,o,i,n)})}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.Styles=class{constructor(t,e){this.widthCell=t,this.heightCell=e,this.background="#fff5ea",this.borderColor="#343653",this.canvasBorderColor="#ae0066",this.canvasBorderWidth=1,this.lineWidth=2,this.borderWidth=10,this.diffWidth=5,this.fillColor="#fff0e6",this.textColor="#d62061",this.lineColor="#6dc2ff",this.diffColor="#ff2955",this.sisterColor="#339bcb",this.font={Default:"27px 'Segoe UI',Arial,sans-serif",Heading:"44px 'Segoe UI',Arial,sans-serif"}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(6),o=i(8),n=i(9),l=i(1),r=i(10),h=i(11);class a{static serialize(t){let e=new s.PentaWarningError,i=e.penta;console.log("We want to serialize: "+t);let o=t.split(/[\r\n]+/);if(o.length<this.minLines)return e.addError("Text for penta should contain: \nauthor, nbLine nbCols, penta"),e;i.author=o[0].trim(),console.log("Author is :"+i.author);let n=o[1].trim().split(" ").map(t=>Number(t));return console.log("We have lineCol: "+n),2!=n.length?(e.addError('2nd line should provide nb of lines and columns like this "<nbLines> <nbCols>"'),e):(i.lines=n[0],i.columns=n[1],o.length<this.minLines+i.lines?(e.addError("You didn't provide a pentatonic with "+i.lines+" lines"),e):(this.fillAreas(e,o,2),this.fillEnonce(e,o,2+i.lines),e))}static fillAreas(t,e,i){let s,l={};for(let r=i;r<i+t.penta.lines;r++){let h=r-i;if(""==(s=e[r].trim())||null==s)continue;let a=[];s.length!=t.penta.columns&&t.addWarning("Check the number of cells for this line: "+s);for(let e=0;e<t.penta.columns;e++){if(s.length<=e){t.addError("Please check the number of columns you provided fo each line of the pentatonic (index"+e+">="+t.penta.columns+": for the line "+s+")");break}if(e>t.penta.columns){t.addError("Please check the number of columns you provided fo each line of the pentatonic ("+e+">"+t.penta.columns+")");break}let i=new n.Cell(h,e),r=l[s[e]];null==r&&(r=new o.Area(s[e]),l[s[e]]=r),i.area=r,a.push(i)}t.penta.cells.push(a)}t.penta.fillAreaSize()}static fillEnonce(t,e,i){let s,o=e.length,n={};for(let h=i;h<o;h++){if(""==(s=e[h].trim()))continue;if(s.startsWith("-")){let e=s.substr(1).split(",").map(t=>+t);if(4!=e.length){t.addError('For a diffOne, you should have 4 numbers: "-i1,j1,i2,j2" for example. But you typed "'+s+'"');continue}let i=new l.Position(e[0],e[1]),o=new l.Position(e[2],e[3]);if(i==o){t.addError('Difference one should concern 2 different positions. But you typed "'+s+'"');continue}i.isNear(o)||t.addWarning('Difference one should concert 2 near positions. But you typed "'+s+'"'),t.penta.diffOnes.push(new r.Diff(i,o));continue}let i=s.split(",");if(3!=i.length){t.addError("Bad input, should be n,i,j, but was "+s);continue}if(1!=i[0].length){t.addError("Bad input: "+i[0]+" in line "+s);continue}let o=i[0],a=+i[1],c=+i[2],f=t.penta.cells[a][c],d=+o;if(Number.isNaN(d))null==n[o]?n[o]=[new l.Position(a,c)]:n[o].push(new l.Position(a,c));else{console.log("nb is "+o);let t=+o;console.log("Success converting nb to number: "+t),f.values.push(o)}}for(let e in n)t.penta.sisters.push(new h.Sister(e,e,n[e]))}}a.minLines=2,e.Serializer=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(7);e.PentaWarningError=class{constructor(){this.penta=new s.Pentatonic,this.warnings=[],this.errors=[]}addWarning(t){this.warnings.push(t)}addError(t){this.errors.push(t)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.Pentatonic=class{constructor(t=0,e=0){this.id=0,this.version=0,this.areas="",this.difficulty=0,this.author="",this.filename="",this.lines=t,this.columns=e,this.cells=[],this.diffOnes=[],this.sisters=[]}fillAreaSize(){this.getAllAreas().forEach(t=>{let e=this.getAreaCells(t),i=e.size;e.forEach(t=>t.area.size=i)})}cellArray(){let t=[];for(let e of this.cells)for(let i of e)t.push(i);return t}getAllAreas(){let t=new Set;return this.cellArray().forEach(e=>{t.add(e.area)}),t}getAreaCells(t){return new Set(this.cellArray().filter(e=>e.area.id==t.id))}diffOnesHave(t){for(let e of this.diffOnes)if(e.position1==t||e.position2==t)return!0;return!1}sistersHave(t){for(let e of this.sisters)if(e.positions.filter(e=>e.i==t.i&&e.j==t.j).length>0)return!0;return!1}getSisterSymbol(t){for(let e of this.sisters)if(e.positions.filter(e=>e.i==t.i&&e.j==t.j).length>0)return e.symbol;return""}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.Area=class{constructor(t="0",e=0){this.id=t,this.size=e}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(1);e.Cell=class{constructor(t,e){this.position=new s.Position(t,e),this.values=[]}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.Diff=class{constructor(t,e){this.position1=t,this.position2=e}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.Sister=class{constructor(t,e,i){this.id=t,this.symbol=e,this.positions=i}}}]);
//# sourceMappingURL=bundle.js.map